<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PDF Format Multi-Category Exporter</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pptxgenjs/3.12.0/pptxgen.bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
/* --- styles unchanged --- */
body {
  font-family: Arial, sans-serif;
  background: #f0f0f0;
  margin: 0;
  padding: 20px;
  text-align: center;
}
h1 { margin-bottom: 10px; }
.top-bar { margin-bottom: 20px; }
.top-bar button {
  padding: 10px 20px;
  font-size: 16px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background: #004080;
  color: white;
  margin: 5px;
}
.top-bar button:hover { background: #0066cc; }
.category-box {
  border: 2px solid #ccc;
  padding: 15px;
  margin: 15px auto;
  width: 850px;
  background: #fff;
  border-radius: 8px;
}
.category-box input[type=text] {
  padding: 8px;
  font-size: 16px;
  margin-bottom: 10px;
  width: 60%;
}
.drop-zone {
  margin-top: 10px;
  padding: 20px;
  border: 2px dashed #aaa;
  border-radius: 8px;
  cursor: pointer;
  background: #fafafa;
  position: relative;
  height: 120px;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #666;
  font-size: 16px;
}
.drop-zone.dragover {
  background: #e0f7ff;
  border-color: #00aaff;
}
.drop-zone input[type=file] {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.slide {
  width: 800px;
  height: 600px;
  margin: 20px auto;
  background: white;
  position: relative;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}
.category { 
  flex: 1; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  font-size: 50px; 
  font-weight: 800; 
  margin-bottom: 20px; 
}
.images { 
  flex: 1; 
  display: flex; 
  justify-content: space-around; 
  margin-top: 20px; 
  align-items: center; 
  padding: 10px; 
  gap: 10px; 
}
.image-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 350px;
  position: relative;
}
.image-label {
  font-weight: 800;
  font-size: 32px;
  text-transform: uppercase;
  color: black;
  margin-bottom: 50px;
}
.images img {
  width: 100%;
  height: 450px;
  border: 1px solid #ccc;
  border-radius: 4px;
  object-fit: cover;
}
.after-image{
   width: 100%;
  height: 450px;
}
.footer { display: none; }

/* Progress Overlay */
#progressOverlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.85);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  flex-direction: column;
}
#progressCircleContainer {
  position: relative;
  width: 120px;
  height: 120px;
}
.neon-ring {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  border: 8px solid transparent;
  border-top-color: #00f0ff;
  border-radius: 50%;
  animation: spin 1.2s linear infinite;
}
.neon-ring:nth-child(2) { border-top-color: #ff00f0; animation-duration: 1.6s; }
.neon-ring:nth-child(3) { border-top-color: #00ff88; animation-duration: 2s; }
@keyframes spin { 0%{transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
#progressText {
  margin-top: 25px;
  font-weight: bold;
  font-size: 20px;
  color: #0ff;
  text-align: center;
  text-shadow: 0 0 8px #0ff, 0 0 16px #0ff;
}
#progressText span { margin: 3px 0; }
</style>
</head>
<body>
<h1>Malaya - Multi-Category PDF Generator</h1>

<div class="top-bar">
  <button onclick="addCategory()">+ Add Category</button>
  <button onclick="downloadPDF()">Download PDF</button>
</div>

<div id="categoriesContainer"></div>
<div id="slidesContainer"></div>

<div id="progressOverlay" class="flex">
  <div id="progressCircleContainer">
    <div class="neon-ring"></div>
    <div class="neon-ring"></div>
    <div class="neon-ring"></div>
  </div>
  <div id="progressText">
    <span id="percentage">0%</span>
    <span id="slideCount">0 / 0 slides</span>
  </div>
</div>

<script>
let categories = [];

function addCategory() {
  const index = categories.length;
  categories.push({ name: "", images: [] });
  const container = document.getElementById("categoriesContainer");
  const box = document.createElement("div");
  box.className = "category-box";
  box.innerHTML = `
    <h3>Category ${index+1}</h3>
    <input type="text" placeholder="Enter category name" oninput="updateCategoryName(${index}, this.value)">
    <div class="drop-zone" id="dropZone-${index}">
      <span>Drag & Drop Images Here or Click to Upload</span>
      <input type="file" id="fileInput-${index}" multiple accept="image/*" onchange="updateCategoryImages(${index}, this.files)">
    </div>
  `;
  container.prepend(box);

  enableDragDrop(index);
}

function enableDragDrop(index) {
  const dropZone = document.getElementById("dropZone-" + index);

  dropZone.addEventListener("dragover", (e) => {
    e.preventDefault();
    dropZone.classList.add("dragover");
  });

  dropZone.addEventListener("dragleave", () => {
    dropZone.classList.remove("dragover");
  });

  dropZone.addEventListener("drop", (e) => {
    e.preventDefault();
    dropZone.classList.remove("dragover");
    const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith("image/"));
    if (files.length > 0) {
      categories[index].images.push(...files.map(f => URL.createObjectURL(f)));
      renderSlides();
    }
  });
}

function updateCategoryName(index, value) { 
  categories[index].name = value; 
  renderSlides(); 
}

function updateCategoryImages(index, files) { 
  categories[index].images.push(...Array.from(files).map(f => URL.createObjectURL(f))); 
  renderSlides(); 
}

function renderSlides() {
  const container = document.getElementById("slidesContainer");
  container.innerHTML = "";
  let slideCount = 0;
  categories.forEach(cat => {
    if(!cat.name && cat.images.length === 0) return;

    const firstSlide = document.createElement("div");
    firstSlide.className = "slide";
    firstSlide.id = "slide-" + slideCount;
    firstSlide.innerHTML = `<div class="category">${cat.name || "Category"}</div>`;
    container.appendChild(firstSlide);
    slideCount++;

    for (let i = 0; i < cat.images.length; i++) {
      const slide = document.createElement("div");
      slide.className = "slide";
      slide.id = "slide-" + slideCount;
      let img1 = cat.images[i] ? `<img src="${cat.images[i]}">` : "";
      slide.innerHTML = `
        <div class="images">
          <div class="image-container">
            <span class="image-label">Before</span>
            ${img1}
          </div>
          <div class="image-container">
            <span class="image-label">After</span>
            <div class="after-image"></div>
          </div>
        </div>
      `;
      container.appendChild(slide);
      slideCount++;
    }
  });
}

async function downloadPDF(){
  if(categories.length === 0) return alert("Add at least one category!");
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("landscape", "pt", "a4");

  const overlay = document.getElementById("progressOverlay");
  const percentageText = document.getElementById("percentage");
  const slideCountText = document.getElementById("slideCount");
  overlay.style.display = "flex";

  const totalSlides = categories.reduce((acc, cat) => {
    if(!cat.name && cat.images.length === 0) return acc;
    return acc + 1 + cat.images.length;
  }, 0);

  let slideIndex = 0;
  function updateProgress(index) {
    const percent = Math.round((index / totalSlides) * 100);
    percentageText.innerText = percent + "%";
    slideCountText.innerText = index + " / " + totalSlides + " slides";
  }

  for (let c = 0; c < categories.length; c++) {
    const cat = categories[c];
    if (!cat.name && cat.images.length === 0) continue;

    const catSlide = await html2canvas(document.getElementById("slide-" + slideIndex));
    pdf.addImage(catSlide.toDataURL("image/jpeg", 0.6), "JPEG", 0, 0, 800, 500);
    slideIndex++;
    updateProgress(slideIndex);

    for (let i = 0; i < cat.images.length; i++) {
      pdf.addPage();
      const canvas = await html2canvas(document.getElementById("slide-" + slideIndex));
      pdf.addImage(canvas.toDataURL("image/jpeg", 0.6), "JPEG", 0, 0, 800, 500);
      slideIndex++;
      updateProgress(slideIndex);
    }

    if (c < categories.length - 1) pdf.addPage();
  }

  overlay.style.display = "none";
  pdf.save("HS_CO_Presentation.pdf");
}
</script>
</body>
</html>
